generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/neurolearn_ai_tutor/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model ChatSession {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  messages  Message[]
  metrics   AgentMetric[]
}

model Message {
  id            String      @id @default(cuid())
  content       String      @db.Text
  role          String
  agentType     String?
  modelUsed     String?
  searchSources Json?
  createdAt     DateTime    @default(now())
  sessionId     String
  session       ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model AgentMetric {
  id                   String      @id @default(cuid())
  agentType            String
  questionsHandled     Int         @default(0)
  averageResponseTime  Float?
  successfulHandoffs   Int         @default(0)
  sessionId            String
  session              ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  createdAt            DateTime    @default(now())

  @@index([sessionId])
  @@index([agentType])
}

model Note {
  id          String    @id @default(cuid())
  title       String
  content     String    @db.Text
  subject     String?
  tags        String[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  concepts    Concept[]
  flashcards  Flashcard[]
}

model Concept {
  id              String               @id @default(cuid())
  name            String
  description     String?              @db.Text
  subject         String?
  noteId          String?
  note            Note?                @relation(fields: [noteId], references: [id], onDelete: Cascade)
  createdAt       DateTime             @default(now())
  relationsFrom   ConceptRelationship[] @relation("ConceptFrom")
  relationsTo     ConceptRelationship[] @relation("ConceptTo")

  @@index([noteId])
  @@index([subject])
}

model ConceptRelationship {
  id              String    @id @default(cuid())
  fromConceptId   String
  toConceptId     String
  relationshipType String
  strength        Float     @default(1.0)
  fromConcept     Concept   @relation("ConceptFrom", fields: [fromConceptId], references: [id], onDelete: Cascade)
  toConcept       Concept   @relation("ConceptTo", fields: [toConceptId], references: [id], onDelete: Cascade)
  createdAt       DateTime  @default(now())

  @@index([fromConceptId])
  @@index([toConceptId])
}

model Flashcard {
  id          String            @id @default(cuid())
  front       String            @db.Text
  back        String            @db.Text
  subject     String?
  difficulty  String            @default("medium")
  noteId      String?
  note        Note?             @relation(fields: [noteId], references: [id], onDelete: Cascade)
  createdAt   DateTime          @default(now())
  reviews     FlashcardReview[]

  @@index([noteId])
  @@index([subject])
}

model FlashcardReview {
  id            String    @id @default(cuid())
  flashcardId   String
  flashcard     Flashcard @relation(fields: [flashcardId], references: [id], onDelete: Cascade)
  quality       Int
  easeFactor    Float
  interval      Int
  repetitions   Int
  nextReviewAt  DateTime
  reviewedAt    DateTime  @default(now())

  @@index([flashcardId])
  @@index([nextReviewAt])
}

model KnowledgePack {
  id          String   @id @default(cuid())
  title       String
  subject     String
  description String   @db.Text
  content     Json
  difficulty  String   @default("intermediate")
  topics      String[]
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([subject])
}

model StudentProfile {
  id              String   @id @default(cuid())
  name            String
  email           String?  @unique
  avatar          String?
  grade           String?
  learningStyle   String   @default("visual")
  interests       String[]
  strengths       String[]
  goals           String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  classes         ClassEnrollment[]
  progress        LearningProgress[]
}

model Class {
  id          String   @id @default(cuid())
  title       String
  subject     String
  description String   @db.Text
  imageUrl    String?
  difficulty  String   @default("intermediate")
  topics      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  enrollments ClassEnrollment[]
  modules     LearningModule[]

  @@index([subject])
}

model ClassEnrollment {
  id              String         @id @default(cuid())
  studentId       String
  classId         String
  student         StudentProfile @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class           Class          @relation(fields: [classId], references: [id], onDelete: Cascade)
  enrolledAt      DateTime       @default(now())
  completionRate  Float          @default(0)

  @@index([studentId])
  @@index([classId])
  @@unique([studentId, classId])
}

model LearningModule {
  id          String   @id @default(cuid())
  title       String
  classId     String
  class       Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  content     String   @db.Text
  orderIndex  Int
  imageUrl    String?
  resources   Json?
  createdAt   DateTime @default(now())

  @@index([classId])
}

model LearningProgress {
  id              String         @id @default(cuid())
  studentId       String
  student         StudentProfile @relation(fields: [studentId], references: [id], onDelete: Cascade)
  itemType        String
  itemId          String
  status          String         @default("in_progress")
  score           Float?
  timeSpent       Int            @default(0)
  completedAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([studentId])
  @@index([itemType, itemId])
}